# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/
#
# Run: cargo deny check
# CI:  cargo install cargo-deny && cargo deny check

[graph]
targets = [
    "x86_64-unknown-linux-gnu",
    "aarch64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
]
all-features = false
no-default-features = false

# --- Advisories (vulnerability scanning) ---
[advisories]
# Advisories with known vulnerabilities will cause a check failure.
# Yanked crate versions produce warnings.
yanked = "warn"
# Crates with known advisories that have been evaluated and accepted.
# Each entry requires a justification comment.
ignore = [
    # paste is unmaintained (RUSTSEC-2024-0436) but is a transitive dep of ratatui
    # with no security impact. Will be resolved when ratatui migrates to pastey.
    { id = "RUSTSEC-2024-0436", reason = "transitive dep from ratatui, no security impact" },
]

# --- Licenses ---
[licenses]
# Allow common permissive licenses used by Rust ecosystem.
allow = [
    "MIT",
    "Apache-2.0",
    "BSD-3-Clause",
    "ISC",
    "Unicode-3.0",
    "Zlib",
    "BSL-1.0",
    "CC0-1.0",
    "CDLA-Permissive-2.0",
    "OpenSSL",
]
confidence-threshold = 0.8

[[licenses.clarify]]
name = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

# libbz2-rs-sys uses the bzip2-1.0.6 license which is a permissive BSD-style license.
[[licenses.exceptions]]
allow = ["bzip2-1.0.6"]
name = "libbz2-rs-sys"

# --- Bans (duplicate/denied crates) ---
[bans]
# Warn on multiple versions of the same crate (common in large dep trees).
multiple-versions = "warn"
wildcards = "allow"
highlight = "all"

# --- Sources (registry restrictions) ---
[sources]
unknown-registry = "deny"
unknown-git = "deny"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []
