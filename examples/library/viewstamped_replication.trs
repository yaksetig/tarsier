protocol ViewstampedReplication {
    params n, t, f;
    resilience: n = 2*f + 1;

    adversary {
        model: crash;
        bound: f;
        values: sign;
    }

    message StartView(view: nat);
    message Prepare(view: nat, slot: nat);
    message Commit(view: nat, slot: nat);

    role Replica {
        var decided: bool = false;
        init start;

        phase start {
            when received >= n-f StartView(view=0) => {
                goto phase prepare;
            }
        }

        phase prepare {
            when received >= n-f Prepare(view=0, slot=0) => {
                goto phase commit;
            }
        }

        phase commit {
            when received >= n-f Commit(view=0, slot=0) => {
                decided = true;
                goto phase decided;
            }
        }

        phase decided {}
    }

    property agreement: agreement {
        forall p: Replica. forall q: Replica. p.decided == q.decided
    }
}
