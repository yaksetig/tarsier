protocol TendermintCryptoQCBugFaithful {
    params n, t, f, gst;
    resilience: n > 3*t;

    adversary {
        model: byzantine;
        bound: f;
        timing: partial_synchrony;
        gst: gst;
        auth: signed;
        network: identity_selective;
        delivery: per_recipient;
        faults: per_recipient;
        equivocation: full;
        values: sign;
    }

    identity Replica: role key replica_key;
    channel Prevote: authenticated;

    message Prevote(round: nat in 0..0, value: bool);
    certificate Polka from Prevote threshold 1 signer Replica;

    role Replica {
        var decided: bool = false;
        var decision: bool = false;

        init collect;

        phase collect {
            when received >= 1 Prevote(round=0, value=true) => {
                form Polka(round=0, value=true) to Replica;
            }
            when received >= 1 Prevote(round=0, value=false) => {
                form Polka(round=0, value=false) to Replica;
            }
            when has Polka(round=0, value=true) => {
                lock Polka(round=0, value=true);
                decision = true;
                decided = true;
                decide true;
                goto phase done;
            }
            when has Polka(round=0, value=false) => {
                lock Polka(round=0, value=false);
                decision = false;
                decided = true;
                decide false;
                goto phase done;
            }
        }

        phase done {}
    }

    property agreement: agreement {
        forall p: Replica. forall q: Replica.
            (p.decided == true && q.decided == true) ==> (p.decision == q.decision)
    }
}
