# Trust Report Schema (v1)

This document defines the schema for machine-readable trust reports generated by Tarsier.

## Scope

A trust report captures the trust-boundary posture for a verification run or certificate check. It provides machine-readable sections covering:

- **Claim layers**: What is verified vs what remains trusted at each claim level
- **Threat model**: Known attack vectors and their countermeasure status
- **Verification scope**: Solvers, proof engine, soundness mode, and certificate schema version
- **Residual assumptions**: Assumptions that remain even after successful verification

Trust reports are generated by `tarsier trust-report` or via the `--trust-report` flag on `certify-safety` and `certify-fair-liveness` commands.

## Versioning Policy

- Current schema version: **1**
- Field: `schema_version`
- Compatibility policy: **exact match only** (`schema_version == 1`)

If the schema changes:

1. bump `schema_version`;
2. update the generator and validation logic;
3. update this document and the JSON schema file;
4. add migration notes.

## Validation Contract (v1)

- Strict decoding (`deny_unknown_fields`): unknown keys are rejected.
- `governance_profile` must be one of: `standard`, `reinforced`, `high-assurance`.
- `trust_boundary.claim_layers` must be non-empty.
- Each claim layer `status` must be `enforced`, `optional`, or `not_applicable`.
- Each threat entry `status` must be `enforced`, `available`, or `not_applicable`.
- `verification_scope.solvers` must be non-empty.
- `verification_scope.soundness` must be `strict` or `permissive`.
- `residual_assumptions` must be non-empty (there are always residual assumptions).

## Signed Reports

Release trust reports are cryptographically signed using [Sigstore Cosign](https://docs.sigstore.dev/cosign/overview/) keyless signing. This binds each report to the CI workflow identity that produced it.

### Sidecar Files

| File | Description |
|------|-------------|
| `trust-report.json` | The trust report itself |
| `trust-report.json.sig` | Cosign detached signature (base64-encoded) |
| `trust-report.json.pem` | Signing certificate (X.509 PEM, contains OIDC identity) |

### Verification

```bash
cosign verify-blob \
  --signature trust-report.json.sig \
  --certificate trust-report.json.pem \
  --certificate-identity-regexp "github\\.com" \
  --certificate-oidc-issuer "https://token.actions.githubusercontent.com" \
  trust-report.json
```

### Signing Policy

- Trust reports are signed during the release certification gate (`release-proof-independent-gate` job).
- The signing identity is the GitHub Actions OIDC token for the workflow run.
- Reports are only signed after all proof-independent checks pass.
- Unsigned trust reports generated locally (via `tarsier generate-trust-report`) are valid but carry no provenance guarantee.

## `trust-report.json` Fields (v1)

Top-level object:

- `schema_version: integer` (must be `1`)
- `generated_at: string` (ISO 8601 UTC timestamp)
- `generator: string` (tool and version)
- `governance_profile: string` (`standard`, `reinforced`, or `high-assurance`)
- `trust_boundary: object`
- `verification_scope: object`
- `residual_assumptions: array<object>`

### Trust Boundary

- `claim_layers: array<object>` — Each claim layer object:
  - `name: string` (e.g., `certificate_integrity`, `smt_replay`, `multi_solver_replay`, `proof_object_path`, `source_obligation_consistency`)
  - `what_is_verified: string`
  - `what_is_trusted: string`
  - `status: string` (`enforced`, `optional`, `not_applicable`)

- `threat_model: array<object>` — Each threat entry:
  - `category: string` (e.g., `tampering`, `soundness`, `modeling`, `supply_chain`, `replay_evasion`)
  - `vector: string`
  - `countermeasure: string`
  - `status: string` (`enforced`, `available`, `not_applicable`)

### Verification Scope

- `protocol_file: string|null` (optional)
- `solvers: array<string>` (e.g., `["z3"]`)
- `proof_engine: string` (`kinduction` or `pdr`)
- `soundness: string` (`strict` or `permissive`)
- `certificate_schema_version: integer`

### Residual Assumptions

Each object:

- `name: string`
- `description: string`
- `mitigation: string|null` (optional)

## Cross-References

| Artifact | Path | Relationship |
|----------|------|-------------|
| Machine-readable JSON schema | `docs/trust-report-schema-v1.json` | Formal schema for trust report validation |
| Trust boundary documentation | `docs/TRUST_BOUNDARY.md` | Source of truth for claim layers, threat model, and residual assumptions |
| Security policy | `SECURITY.md` | Supply-chain integrity and vulnerability reporting scope |
| CLI trust-report command | `crates/tarsier-cli/src/main.rs` | Generator for trust reports |
| Signed trust report artifacts | GitHub Release assets | Cosign keyless signature + certificate sidecars |

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| v1 | 2026-02 | Initial schema: claim layers, threat model, verification scope, residual assumptions. Governance profile tagging. |

## Machine-Readable Schema

See `docs/trust-report-schema-v1.json`.
